import{c as b,B as v,F as S,r as l,E as D,j as e,G as x,H as f,I as g,K as h,U as P,S as w,C as H,L as C,M as q}from"./index-a996d77c.js";import{S as B}from"./search-9e1431e9.js";const E=b("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),R=()=>{const{toast:r}=v(),a=JSON.parse(localStorage.getItem(S)),[o,y]=l.useState((a==null?void 0:a.cnpj)||""),[n,d]=l.useState([]),[i,m]=l.useState(!1),p=l.useCallback(async s=>{if(!s){r({title:"Atenção",description:"Digite um CNPJ para pesquisar.",variant:"default"}),d([]);return}if(!a||!a.id){r({title:"Erro de Autenticação",description:"Usuário não identificado.",variant:"destructive"});return}m(!0);try{const{data:c,error:u}=await D.from("notas_fiscais").select("numero_nota, data_nota, total_calculado, items, created_at").eq("user_id",a.id).eq("cnpj_emitente",s).order("data_nota",{ascending:!1});if(u)throw u;const j=c.map(t=>({tipo:"Nota Fiscal",id:t.numero_nota,data:t.data_nota,valor:t.total_calculado,detalhes:`${t.items?t.items.length:0} itens`,criado_em:t.created_at})).sort((t,N)=>new Date(N.data||N.criado_em)-new Date(t.data||t.criado_em));d(j),j.length===0?r({title:"Sem Resultados",description:`Nenhum histórico encontrado para o CNPJ: ${s}.`}):r({title:"Histórico Carregado",description:`Histórico para ${s} exibido.`})}catch(c){r({title:"Erro ao Buscar Histórico",description:c.message,variant:"destructive"}),d([])}finally{m(!1)}},[r,a]);l.useEffect(()=>{a!=null&&a.cnpj&&p(a.cnpj)},[a==null?void 0:a.cnpj]);const _=()=>{p(o)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Histórico por CNPJ"}),e.jsxs(x,{className:"glass-card",children:[e.jsx(f,{children:e.jsx(g,{children:"Pesquisar Histórico"})}),e.jsxs(h,{className:"flex flex-col sm:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx(P,{htmlFor:"cnpjPesquisa",children:"CNPJ"}),e.jsx(w,{id:"cnpjPesquisa",value:o,onChange:s=>y(s.target.value),placeholder:"Digite o CNPJ"})]}),e.jsxs(H,{onClick:_,disabled:i,children:[i?e.jsx(C,{className:"mr-2"}):e.jsx(B,{className:"mr-2 h-4 w-4"}),"Pesquisar"]})]})]}),i&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx(C,{size:32})," ",e.jsx("p",{className:"ml-2 inline",children:"Carregando histórico..."})]}),!i&&n.length===0&&e.jsx(x,{className:"glass-card text-center py-12",children:e.jsxs(h,{children:[e.jsx(E,{className:"mx-auto h-16 w-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Nenhum histórico para exibir."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use a pesquisa acima para encontrar dados de um CNPJ."})]})}),!i&&n.length>0&&e.jsxs(x,{className:"glass-card",children:[e.jsx(f,{children:e.jsxs(g,{children:["Resultados para CNPJ: ",o]})}),e.jsx(h,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"p-2 text-left",children:"Data"}),e.jsx("th",{className:"p-2 text-left",children:"Tipo"}),e.jsx("th",{className:"p-2 text-left",children:"ID/Referência"}),e.jsx("th",{className:"p-2 text-left",children:"Valor (R$)"}),e.jsx("th",{className:"p-2 text-left",children:"Detalhes"})]})}),e.jsx("tbody",{children:n.map((s,c)=>e.jsxs(q.tr,{className:"border-b hover:bg-muted/50",initial:{opacity:0},animate:{opacity:1},children:[e.jsx("td",{className:"p-2",children:s.data?new Date(s.data+"T00:00:00").toLocaleDateString("pt-BR"):new Date(s.criado_em).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"p-2",children:s.tipo}),e.jsx("td",{className:"p-2",children:s.id}),e.jsx("td",{className:"p-2",children:parseFloat(s.valor||0).toLocaleString("pt-BR",{minimumFractionDigits:2})}),e.jsx("td",{className:"p-2",children:s.detalhes})]},c))})]})})})]})]})};export{R as default};
