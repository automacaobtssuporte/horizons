import{B as S,r,F as w,E as P,j as e,L as F,G as f,H as h,I as p,J as N,K as g,C as M,M as R,Q as T}from"./index-a996d77c.js";import{F as _}from"./file-text-fee5fbf7.js";import{D as B}from"./dollar-sign-0ce09540.js";import{P as G}from"./percent-2438f5a2.js";const D=()=>{const{toast:t}=S(),[d,v]=r.useState({totalNotas:0,totalValorNotas:0,pecasProcessadas:0,rendimentoMedio:0}),[b,o]=r.useState(!0),[m,E]=r.useState(null);r.useEffect(()=>{const a=localStorage.getItem(w);a?E(JSON.parse(a)):(o(!1),t({title:"Erro de Autenticação",description:"Usuário não encontrado no localStorage.",variant:"destructive"}))},[t]);const j=r.useCallback(async a=>{if(!a||!a.id||!a.cnpj){t({title:"Informação Incompleta",description:"ID do usuário ou CNPJ não disponível para carregar dados.",variant:"destructive"}),o(!1);return}o(!0);try{const{data:s,error:c}=await P.from("notas_fiscais").select("total_calculado, items").eq("user_id",a.id).eq("cnpj_emitente",a.cnpj);if(c){console.error("Error fetching notas:",c),t({title:"Erro ao buscar dados",description:"Não foi possível carregar as notas fiscais.",variant:"destructive"}),o(!1);return}const n=(s==null?void 0:s.length)||0,u=(s==null?void 0:s.reduce((x,l)=>x+parseFloat(l.total_calculado||0),0))||0,y=(s==null?void 0:s.reduce((x,l)=>x+(l.items?l.items.length:0),0))*5||0,C=n>0?(Math.random()*(85-70)+70).toFixed(2):0;v({totalNotas:n,totalValorNotas:u,pecasProcessadas:y,rendimentoMedio:C})}catch(s){console.error("Error in dashboard data fetch:",s),t({title:"Erro inesperado",description:"Ocorreu um problema ao carregar o dashboard.",variant:"destructive"})}finally{o(!1)}},[t]);r.useEffect(()=>{m&&j(m)},[m,j]);const i=(a,s,c,n="",u="text-primary")=>e.jsx(R.div,{whileHover:{scale:1.05},transition:{type:"spring",stiffness:300},children:e.jsxs(f,{className:"glass-card hover-lift",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:a}),c]}),e.jsx(g,{children:e.jsxs("div",{className:`text-2xl font-bold ${u}`,children:[s," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:n})]})})]})});return b?e.jsxs("div",{className:"flex justify-center items-center h-64",children:[e.jsx(F,{size:48})," ",e.jsx("p",{className:"ml-3",children:"Carregando dados do dashboard..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard Geral"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[i("Total de Notas",d.totalNotas,e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})),i("Valor Total Processado",d.totalValorNotas.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})),i("Peças Processadas (Est.)",d.pecasProcessadas,e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})),i("Rendimento Médio (Est.)",d.rendimentoMedio,e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),"%")]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(f,{className:"glass-card",children:[e.jsxs(h,{children:[e.jsx(p,{children:"Atividade Recente"}),e.jsx(N,{children:"Últimas notas fiscais processadas."})]}),e.jsxs(g,{children:[e.jsx("p",{className:"text-muted-foreground",children:"Funcionalidade de histórico de atividades em breve."}),e.jsx(M,{onClick:()=>t({title:"Em Desenvolvimento",description:"Gráficos de atividade estarão disponíveis em breve."}),className:"mt-4",children:"Ver Detalhes"})]})]}),e.jsxs(f,{className:"glass-card",children:[e.jsxs(h,{children:[e.jsx(p,{children:"Comparativo de Rendimento"}),e.jsx(N,{children:"Acompanhe a performance da desossa."})]}),e.jsxs(g,{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Gráficos de rendimento em desenvolvimento."}),e.jsx("img",{alt:"Gráfico de exemplo de rendimento de desossa",className:"rounded-lg shadow-md max-w-full h-auto",src:"https://images.unsplash.com/photo-1616261167032-b16d2df8333b"})]})]})]})]})};export{D as default};
